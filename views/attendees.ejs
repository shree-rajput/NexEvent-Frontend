<% layout('layouts/boilerplate') -%>

<h1>Attendees <%= event ? ('for ' + event.EVENT_NAME) : '' %></h1>

<% if(event && user && event.ORGANIZER_ID === user.USER_ID) { %>
<a href="/events/<%= event.EVENT_ID %>/attendees/new" class="btn btn-primary mb-3">Add Attendee Manually</a>
<% } %>

<table cellpadding="5" class="table table-primary table-striped-columns">
  <thead>
    <tr class="table-primary">
      <th>ID</th>
      <th>Name</th>
      <th>Email</th>
      <th>Number</th>
      <th>Event</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% for(let att of attendees) { %>
    <% const isOwner = user && att.USER_ID === user.USER_ID; %>
    <% const isOrganizer = user && event && event.ORGANIZER_ID === user.USER_ID; %>
    <tr class="table-primary">
      <td><%= att.ATTENDEE_ID %></td>
      <td><%= att.NAME %></td>
      <td><%= att.EMAIL || 'N/A' %></td>
      <td><%= att.NUMBER %></td>
      <td><%= att.EVENT_NAME || (event ? event.EVENT_NAME : 'N/A') %></td>
      <td><%= att.STATUS %></td>
      <td>
        <% if(isOwner) { %>
          <a href="/attendees/<%= att.ATTENDEE_ID %>/edit" class="btn btn-primary me-2">Edit</a>
          <form action="/attendees/<%= att.ATTENDEE_ID %>?_method=DELETE" method="POST" style="display: inline">
            <button type="submit" class="btn btn-danger" onclick="return confirm('Leave this event?')">Leave Event</button>
          </form>
        <% } else if(isOrganizer) { %>
          <form action="/attendees/<%= att.ATTENDEE_ID %>?_method=DELETE" method="POST" style="display: inline">
            <button type="submit" class="btn btn-danger" onclick="return confirm('Remove this attendee?')">Remove Attendee</button>
          </form>
        <% } %>
      </td>
    </tr>
    <% } %>
  </tbody>
</table>
